HTML

<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠé€æ˜æŒ‰éˆ•ç”¢ç”Ÿå™¨</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        /* åŸºç¤æ¨£å¼ */
        body {
            display: flex;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
        }

        /* é¸å–®å®¹å™¨æ¨£å¼ */
        #menu {
            width: 300px;
            min-width: 300px;
            padding: 20px;
            margin-right: 20px;
            background-color: #ffffff;
            border: 1px solid #ccc;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
            position: sticky; /* è®“é¸å–®åœ¨æ»¾å‹•æ™‚å›ºå®šåœ¨é ‚éƒ¨ */
            top: 20px;
            height: fit-content;
        }

        /* è¼¸å…¥çµ„ä»¶æ¨£å¼ */
        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 14px;
        }

        .input-group input[type="number"],
        .input-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box; 
        }

        /* é¡¯ç¤ºæ¬„ä½æ¨£å¼ */
        #display-fields {
            margin-top: 20px;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }

        #end-number {
            font-size: 18px;
            color: #d9534f; 
            font-weight: bold;
        }

        /* ç¢ºå®šæŒ‰éˆ•æ¨£å¼ */
        #confirm-button {
            width: 100%;
            padding: 10px;
            background-color: #5cb85c;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
        }

        #confirm-button:hover {
            background-color: #4cae4c;
        }

        /* P5 ç•«å¸ƒå®¹å™¨æ¨£å¼ */
        #p5-canvas {
            flex-grow: 1; 
            min-height: 500px;
            border: 1px solid #ccc;
            background-color: #ffffff;
        }
    </style>
</head>
<body>

    <div id="menu">
        <h2>ğŸ“Š æŒ‰éˆ•åƒæ•¸è¨­å®š</h2>
        <hr>

        <div class="input-group">
            <label for="btn-width">åŠé€æ˜æŒ‰éˆ•çš„å¯¬ (pixel):</label>
            <input type="number" id="btn-width" value="100" min="10">
        </div>

        <div class="input-group">
            <label for="btn-height">åŠé€æ˜æŒ‰éˆ•çš„é«˜ (pixel):</label>
            <input type="number" id="btn-height" value="50" min="10">
        </div>

        <div class="input-group">
            <label for="cols">åŠé€æ˜æŒ‰éˆ•çš„æ©«åˆ— $i$ (å€‹æ•¸):</label>
            <input type="number" id="cols" value="5" min="1">
        </div>

        <div class="input-group">
            <label for="rows">åŠé€æ˜æŒ‰éˆ•çš„ç›´è¡Œ $j$ (å€‹æ•¸):</label>
            <input type="number" id="rows" value="3" min="1">
        </div>

        <div class="input-group">
            <label for="start-num">æŒ‰éˆ•çš„èµ·å§‹è™Ÿç¢¼:</label>
            <input type="number" id="start-num" value="1" min="0"> </div>

        <div class="input-group">
            <label for="start-point">è™Ÿç¢¼çš„èµ·å§‹é»:</label>
            <select id="start-point">
                <option value="top-left">å·¦ä¸Š</option>
                <option value="top-right">å³ä¸Š</option>
                <option value="bottom-left" selected>å·¦ä¸‹</option> <option value="bottom-right">å³ä¸‹</option>
            </select>
        </div>

        <div class="input-group">
            <label for="sequence-type">è™Ÿç¢¼çš„å¢åŠ é †åº:</label>
            <select id="sequence-type">
                <option value="sequential" selected>é€å±¤ä¾åº</option> <option value="snake">è›‡è¡Œ</option>
            </select>
        </div>

        <hr>

        <div id="display-fields">
            <label>æŒ‰éˆ•çš„æœ«å°¾è™Ÿç¢¼:</label>
            <div id="end-number">0</div>
        </div>
        
        <button id="confirm-button">ç¢ºå®šç”Ÿæˆ</button>

    </div>

    <div id="p5-canvas"></div>

    <script>
        // P5.js æ ¸å¿ƒè®Šæ•¸
        let buttonMatrix = []; // å„²å­˜æŒ‰éˆ•ç‹€æ…‹çš„çŸ©é™£ (1: é»ƒè‰², 0: è—è‰²)
        let matrixRows = 0;
        let matrixCols = 0;
        let btnW = 0;
        let btnH = 0;
        const PADDING = 1; // æŒ‰éˆ•é–“çš„é–“éš”
        let startNum = 1;
        let startPoint = 'bottom-left';
        let sequenceType = 'sequential';

        // =================================================================
        // P5.js Setup
        // =================================================================
        function setup() {
            let canvasContainer = document.getElementById('p5-canvas');
            // å‰µå»ºç•«å¸ƒï¼Œå°ºå¯¸æœƒæ ¹æ“šå®¹å™¨èª¿æ•´
            let canvas = createCanvas(canvasContainer.offsetWidth, 500).parent('p5-canvas');
            rectMode(CORNER);
            textAlign(CENTER, CENTER);
            textSize(12);

            // åˆå§‹ç”ŸæˆçŸ©é™£
            confirmSettings();
            noLoop(); // åªåœ¨éœ€è¦æ›´æ–°æ™‚é‡ç¹ª

            // ç›£è½çª—å£å¤§å°è®ŠåŒ–ï¼Œèª¿æ•´ç•«å¸ƒå¤§å°
            window.addEventListener('resize', () => {
                let newHeight = max(500, (btnH + PADDING * 2) * matrixRows + 40); // ç¢ºä¿é«˜åº¦è¶³å¤ 
                resizeCanvas(canvasContainer.offsetWidth, newHeight);
                redraw(); 
            });

            // ç¶å®šç¢ºèªæŒ‰éˆ•äº‹ä»¶
            document.getElementById('confirm-button').addEventListener('click', confirmSettings);
        }

        // =================================================================
        // P5.js Draw Loop
        // =================================================================
        function draw() {
            background(240); // æ·ºç°è‰²èƒŒæ™¯

            let currentNumber = startNum;
            
            // ç¸½æŒ‰éˆ•çš„å°ºå¯¸ (å« padding)
            let totalW = (btnW + PADDING * 2) * matrixCols;
            let totalH = (btnH + PADDING * 2) * matrixRows;
            
            // è®“çŸ©é™£ç½®ä¸­
            let startX = (width - totalW) / 2;
            let startY = (height - totalH) / 2;

            // éæ­·æ‰€æœ‰æŒ‰éˆ•ä½ç½®
            for (let j = 0; j < matrixRows; j++) {
                for (let i = 0; i < matrixCols; i++) {
                    
                    // 1. ç¹ªè£½æŒ‰éˆ•æœ¬èº«
                    let btnState = buttonMatrix[j][i];
                    let x = startX + (btnW + PADDING * 2) * i + PADDING;
                    let y = startY + (btnH + PADDING * 2) * j + PADDING;

                    // é¡è‰²è¨­å®š
                    if (btnState === 1) {
                        fill(255, 255, 0, 180); // é»ƒè‰²åŠé€æ˜
                    } else {
                        fill(0, 0, 255, 180); // è—è‰²åŠé€æ˜
                    }
                    stroke(0, 0, 0, 255); 
                    strokeWeight(1);
                    rect(x, y, btnW, btnH);

                    // 2. ç¹ªè£½çŸ©é™£å…ƒç´ å€¼ (ç½®ä¸­é ä¸‹)
                    fill(0); // é»‘è‰²æ–‡å­—
                    noStroke();
                    textAlign(CENTER, BOTTOM);
                    text(btnState, x + btnW / 2, y + btnH - 5); 
                }
            }

            // 3. ç¹ªè£½æŒ‰éˆ•è™Ÿç¢¼ (éœ€æ ¹æ“šé †åºé‚è¼¯é€²è¡Œ)
            let tempCurrentNumber = startNum;
            
            for (let numIdx = 0; numIdx < matrixRows * matrixCols; numIdx++) {
                
                // ç²å–ç•¶å‰é †åºç´¢å¼• numIdx å°æ‡‰åˆ°å¯¦éš›çŸ©é™£ (i, j) çš„ä½ç½®
                let pos = getMatrixPositionBySequence(numIdx, matrixCols, matrixRows, startPoint, sequenceType);
                let i = pos.i;
                let j = pos.j;

                // æª¢æŸ¥è©²æŒ‰éˆ•ç‹€æ…‹
                if (buttonMatrix[j][i] === 1) {
                    
                    // è¨ˆç®—æŒ‰éˆ•ä¸­å¿ƒåº§æ¨™
                    let x = startX + (btnW + PADDING * 2) * i + PADDING;
                    let y = startY + (btnH + PADDING * 2) * j + PADDING;

                    // ç¹ªè£½è™Ÿç¢¼ (ç½®ä¸­é ä¸Š)
                    fill(0); 
                    noStroke();
                    textAlign(CENTER, TOP);
                    text(tempCurrentNumber, x + btnW / 2, y + 5); 
                    
                    tempCurrentNumber++; // è™Ÿç¢¼éå¢
                }
                // å¦‚æœçŸ©é™£å€¼ç‚º 0 (è—è‰²æŒ‰éˆ•)ï¼Œå‰‡è·³éé¡¯ç¤ºè™Ÿç¢¼ï¼Œä½† numIdx ç¹¼çºŒå¢åŠ 
            }
        }

        // =================================================================
        // P5.js Mouse Interaction
        // =================================================================
        function mousePressed() {
            // æª¢æŸ¥é»æ“Šæ˜¯å¦åœ¨ç•«å¸ƒå…§
            if (mouseX > 0 && mouseX < width && mouseY > 0 && mouseY < height) {
                
                let totalW = (btnW + PADDING * 2) * matrixCols;
                let totalH = (btnH + PADDING * 2) * matrixRows;
                let startX = (width - totalW) / 2;
                let startY = (height - totalH) / 2;

                // æª¢æŸ¥é»æ“Šåœ¨å“ªå€‹æŒ‰éˆ•ä¸Š
                for (let j = 0; j < matrixRows; j++) {
                    for (let i = 0; i < matrixCols; i++) {
                        let x = startX + (btnW + PADDING * 2) * i + PADDING;
                        let y = startY + (btnH + PADDING * 2) * j + PADDING;

                        if (mouseX > x && mouseX < x + btnW && mouseY > y && mouseY < y + btnH) {
                            // åˆ‡æ›çŸ©é™£ç‹€æ…‹ (1 -> 0, 0 -> 1)
                            buttonMatrix[j][i] = 1 - buttonMatrix[j][i];
                            updateEndNumber(); // æ›´æ–°æœ«å°¾è™Ÿç¢¼
                            redraw(); // ç«‹å³é‡ç¹ª
                            return; 
                        }
                    }
                }
            }
        }
        
        // =================================================================
        // æ ¸å¿ƒé‚è¼¯å‡½æ•¸
        // =================================================================
        
        /**
         * æ ¹æ“šé †åºç´¢å¼• (numIdx) å’Œè¨­å®šï¼Œç²å–è©²ç·¨è™Ÿåœ¨å¯¦éš›çŸ©é™£ä¸­çš„ (i, j) åº§æ¨™ã€‚
         * @param {number} numIdx - æ•¸å­—é †åºçš„ç´¢å¼• (0 åˆ° N*M - 1)
         * @param {number} cols - ç¸½æ¬„ä½æ•¸ (i)
         * @param {number} rows - ç¸½åˆ—æ•¸ (j)
         * @param {string} point - èµ·å§‹é» ('top-left', 'top-right', 'bottom-left', 'bottom-right')
         * @param {string} type - å¢åŠ é †åº ('sequential', 'snake')
         * @returns {{i: number, j: number}} - è©²ç´¢å¼•å°æ‡‰çš„å¯¦éš›çŸ©é™£åº§æ¨™ (i, j)
         */
        function getMatrixPositionBySequence(numIdx, cols, rows, point, type) {
            let numI, numJ; // é€™æ˜¯æ•¸å­—åœ¨é‚è¼¯é †åºä¸­çš„ (i, j)

            if (type === 'sequential') {
                // é€å±¤ä¾åº
                numJ = floor(numIdx / cols);
                numI = numIdx % cols;
            } else {
                // è›‡è¡Œ (S-shape)
                let tempRow = floor(numIdx / cols);
                let tempCol = numIdx % cols;
                
                numJ = tempRow;
                if (tempRow % 2 === 0) {
                    numI = tempCol; // å¶æ•¸è¡Œ: å·¦åˆ°å³
                } else {
                    numI = cols - 1 - tempCol; // å¥‡æ•¸è¡Œ: å³åˆ°å·¦
                }
            }

            // æ ¹æ“šèµ·å§‹é»å°‡é‚è¼¯åº§æ¨™ (numI, numJ) è½‰æ›ç‚ºå¯¦éš›çŸ©é™£åº§æ¨™ (i, j)
            let i, j;
            switch (point) {
                case 'top-left':
                    i = numI;
                    j = numJ;
                    break;
                case 'top-right':
                    i = cols - 1 - numI;
                    j = numJ;
                    break;
                case 'bottom-left':
                    i = numI;
                    j = rows - 1 - numJ;
                    break;
                case 'bottom-right':
                    i = cols - 1 - numI;
                    j = rows - 1 - numJ;
                    break;
            }
            return { i: i, j: j };
        }


        /**
         * æ ¹æ“šè¼¸å…¥æ¬„ä½çš„å€¼ï¼Œé‡æ–°ç”ŸæˆçŸ©é™£ä¸¦æ›´æ–°æ‰€æœ‰è®Šæ•¸ã€‚
         */
        function confirmSettings() {
            // 1. è®€å–è¼¸å…¥å€¼
            btnW = max(10, parseInt(document.getElementById('btn-width').value) || 100);
            btnH = max(10, parseInt(document.getElementById('btn-height').value) || 50);
            matrixCols = max(1, parseInt(document.getElementById('cols').value) || 5); // è®Šæ•¸ i (æ©«åˆ—)
            matrixRows = max(1, parseInt(document.getElementById('rows').value) || 3); // è®Šæ•¸ j (ç›´è¡Œ)
            startNum = parseInt(document.getElementById('start-num').value) || 1;
            startPoint = document.getElementById('start-point').value;
            sequenceType = document.getElementById('sequence-type').value;
            
            // 2. åˆå§‹åŒ–/é‡ç½®æŒ‰éˆ•çŸ©é™£
            let newMatrix = [];
            for (let j = 0; j < matrixRows; j++) {
                newMatrix[j] = [];
                for (let i = 0; i < matrixCols; i++) {
                    // å¦‚æœçŸ©é™£å°ºå¯¸æœªè®Šï¼Œä¿æŒèˆŠçš„ç‹€æ…‹ï¼›å¦å‰‡é è¨­ç‚º 1
                    if (j < buttonMatrix.length && i < buttonMatrix[j].length) {
                        newMatrix[j][i] = buttonMatrix[j][i];
                    } else {
                        newMatrix[j][i] = 1; // é è¨­å€¼ç‚º 1 (é»ƒè‰²)
                    }
                }
            }
            buttonMatrix = newMatrix;

            // èª¿æ•´ç•«å¸ƒå°ºå¯¸ä»¥é©æ‡‰æ–°çš„çŸ©é™£å¤§å°
            let canvasContainer = document.getElementById('p5-canvas');
            let newHeight = max(500, (btnH + PADDING * 2) * matrixRows + 40);
            resizeCanvas(canvasContainer.offsetWidth, newHeight);
            
            // 3. æ›´æ–°æœ«å°¾è™Ÿç¢¼
            updateEndNumber();

            // 4. å¼·åˆ¶é‡ç¹ª P5 ç•«å¸ƒ
            redraw();
        }

        /**
         * è¨ˆç®—ä¸¦æ›´æ–°æœ«å°¾è™Ÿç¢¼ã€‚
         * æœ«å°¾è™Ÿç¢¼ = èµ·å§‹è™Ÿç¢¼ + (çŸ©é™£ä¸­å…ƒç´ ç‚º 1 çš„å€‹æ•¸) - 1
         */
        function updateEndNumber() {
            let countOnButtons = 0;
            for (let j = 0; j < buttonMatrix.length; j++) {
                for (let i = 0; i < buttonMatrix[j].length; i++) {
                    if (buttonMatrix[j][i] === 1) {
                        countOnButtons++;
                    }
                }
            }
            
            // æœ«å°¾è™Ÿç¢¼è¨ˆç®—é‚è¼¯: èµ·å§‹è™Ÿç¢¼ + ç¸½å…±é¡¯ç¤ºçš„è™Ÿç¢¼æ•¸é‡ - 1
            let endNumberValue = startNum + countOnButtons - 1;
            
            // å¦‚æœæ²’æœ‰é–‹å•Ÿçš„æŒ‰éˆ• (countOnButtons=0)ï¼Œå‰‡æœ«å°¾è™Ÿç¢¼æ˜¯èµ·å§‹è™Ÿç¢¼ - 1
            if (countOnButtons === 0 && startNum > 0) {
                 endNumberValue = startNum - 1;
            } else if (countOnButtons === 0 && startNum === 0) {
                 endNumberValue = 0;
            }
            
            document.getElementById('end-number').innerText = endNumberValue;
        }

    </script>

</body>
</html>